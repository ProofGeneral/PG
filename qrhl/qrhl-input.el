;;; qrhl-input.el --- Quail package for TeX-style input for qrhl-tool in ProofGeneral -*- lexical-binding: t -*-

;; Copyright (C) 2001-2022 Free Software Foundation, Inc.
;; Copyright (C) 2001-2011
;;   National Institute of Advanced Industrial Science and Technology (AIST)
;;   Registration Number H14PRO021
;; Copyright (C) 2017-2022 University of Tartu

;; Author: TAKAHASHI Naoto <ntakahas@m17n.org>
;;         Dave Love <fx@gnu.org>
;;         Dominique Unruh <unruh@ut.ee>

;; SPDX-License-Identifier: GPL-3.0-or-later

;;; Commentary:

;; Modified by Dominique Unruh to adapt to the specific requirements of qrhl-tool (https://dominique-unruh.github.io/qrhl-tool/).
;; Based on latin-ltx.el from Emacs 26.3 (https://git.savannah.gnu.org/cgit/emacs.git/tree/lisp/leim/quail/latin-ltx.el?h=emacs-26.3)
;; Main changes:
;; - Changed input method name to "qrhl"
;; - Changed prefix from latin-ltx to qrhl-input
;; - Changed unicode symbol for \cdot, \llbracket, \rrbracket
;; - Disabled sequences starting with _
;; - Appended extra input sequences in the end
;; - Changed to lexical binding
;; - Made code compatible with Emacs 25 (@monnier)

;;; Code:

(require 'quail)

(quail-define-package
 "qrhl" "UTF-8" "\\q " t
 "LaTeX-like input method for use in the qrhl-tool."

 '(("\t" . quail-completion))
 t t nil nil nil nil nil nil nil t)

(eval-when-compile
  (require 'cl-lib)

  (defconst qrhl-input--mark-map
    '(("DOT BELOW" . "d")
      ("DOT ABOVE" . ".")
      ("OGONEK" . "k")
      ("CEDILLA" . "c")
      ("CARON" . "v")
      ;; ("HOOK ABOVE" . ??)
      ("MACRON" . "=")
      ("BREVE" . "u")
      ("TILDE" . "~")
      ("GRAVE" . "`")
      ("CIRCUMFLEX" . "^")
      ("DIAERESIS" . "\"")
      ("DOUBLE ACUTE" . "H")
      ("ACUTE" . "'")))

  (defconst qrhl-input--mark-re (regexp-opt (mapcar #'car qrhl-input--mark-map)))

  (defun qrhl-input--ascii-p (char)
    (and (characterp char) (< char 128)))

  (defmacro qrhl-input--define-rules (&rest rules)
    (load "uni-name")
    (let ((newrules ()))
      (dolist (rule rules)
        (pcase rule
          (`(,_ ,(pred characterp)) (push rule newrules)) ;; Normal quail rule.
          (`(,seq ,re)
           (let* ((count 0)
                  (re (eval re t))
                  (ucs-names (ucs-names))
                  (process-one-entry
              (lambda (name char)
                (when (and (characterp char) ;; Ignore char-ranges.
                           (string-match re name))
                  (let ((keys (if (stringp seq)
                                  (replace-match seq nil nil name)
                                     (funcall (eval seq t) name char))))
                    (if (listp keys)
                        (dolist (x keys)
                          (setq count (1+ count))
                          (push (list x char) newrules))
                      (setq count (1+ count))
                           (push (list keys char) newrules)))))))
             ;; Emacs-25's `ucs-names' returned an alist rather than a hash
             ;; table and that changed to a hash-table in Emacs-26.
             (if (hash-table-p ucs-names)
                 (maphash process-one-entry ucs-names)
               (dolist (pair ucs-names)
                 (funcall process-one-entry (car pair) (cdr pair))))
             ;; (message "qrhl-input: %d mappings for %S" count re)
	     ))))
      (setq newrules (delete-dups newrules))
      (let ((rules (copy-sequence newrules)))
        (while rules
          (let ((rule (pop rules)))
            (when (assoc (car rule) rules)
              (let ((conflicts (list (cadr rule)))
                    (tail rules)
                    c)
                (while (setq c (assoc (car rule) tail))
                  (push (cadr c) conflicts)
                  (setq tail (cdr (memq c tail)))
                  (setq rules (delq c rules)))
                (message "Conflict for %S: %S"
                         (car rule) (apply #'string conflicts)))))))
      (let ((inputs (mapcar #'car newrules)))
        (setq inputs (delete-dups inputs))
        (message "qrhl-input: %d rules (+ %d conflicts)!"
                 (length inputs) (- (length newrules) (length inputs))))
      `(quail-define-rules ,@(nreverse newrules)))))

(qrhl-input--define-rules

 ("!`" ?Â¡)
 ("\\pounds" ?Â£) ;; ("{\\pounds}" ?Â£)
 ("\\S" ?Â§) ;; ("{\\S}" ?Â§)
 ("$^a$" ?Âª)
 ("$\\pm$" ?Â±) ("\\pm" ?Â±)
 ("$^2$" ?Â²)
 ("$^3$" ?Â³)
 ("\\P" ?Â¶) ;; ("{\\P}" ?Â¶)
 ("$\\cdot$" ?â‹…) ("\\cdot" ?â‹…)
 ("$^1$" ?Â¹)
 ("$^o$" ?Âº)
 ("?`" ?Â¿)

 ((lambda (name char)
    (let* ((c (if (match-end 1)
                  (downcase (match-string 2 name))
                (match-string 2 name)))
           (mark1 (cdr (assoc (match-string 3 name) qrhl-input--mark-map)))
           (mark2 (if (match-end 4)
                      (cdr (assoc (match-string 4 name) qrhl-input--mark-map))))
           (marks (if mark2 (concat mark1 "\\" mark2) mark1)))
      (cl-assert mark1)
      (cons (format "\\%s{%s}" marks c)
            ;; Exclude "d" because we use "\\dh" for something else.
            (unless (member (or mark2 mark1) '("d"));; "k"
              (list (format "\\%s%s" marks c))))))
  (concat "\\`LATIN \\(?:CAPITAL\\|SMAL\\(L\\)\\) LETTER \\(.\\) WITH \\("
          qrhl-input--mark-re "\\)\\(?: AND \\("
          qrhl-input--mark-re "\\)\\)?\\'"))

 ((lambda (name char)
    (let* ((mark (cdr (assoc (match-string 1 name) qrhl-input--mark-map))))
      (cl-assert mark)
      (list (format "\\%s" mark))))
  (concat "\\`COMBINING \\(" qrhl-input--mark-re "\\)\\(?: ACCENT\\)?\\'"))

 ((lambda (name char)
    (unless (qrhl-input--ascii-p char)
      (let* ((mark (cdr (assoc (match-string 1 name) qrhl-input--mark-map))))
        (cl-assert mark)
        (list (format "\\%s{}" mark)))))
  (concat "\\`\\(?:SPACING \\)?\\(" qrhl-input--mark-re "\\)\\(?: ACCENT\\)?\\'"))

 ("\\AA" ?Ã…) ;; ("{\\AA}" ?Ã…)
 ("\\AE" ?Ã†) ;; ("{\\AE}" ?Ã†)

 ("$\\times$" ?Ã—) ("\\times" ?Ã—)
 ("\\O" ?Ã˜) ;; ("{\\O}" ?Ã˜)
 ("\\ss" ?ÃŸ) ;; ("{\\ss}" ?ÃŸ)

 ("\\aa" ?Ã¥) ;; ("{\\aa}" ?Ã¥)
 ("\\ae" ?Ã¦) ;; ("{\\ae}" ?Ã¦)

 ("$\\div$" ?Ã·) ("\\div" ?Ã·)
 ("\\o" ?Ã¸) ;; ("{\\o}" ?Ã¸)

 ("\\~{\\i}" ?Ä©)
 ("\\={\\i}" ?Ä«)
 ("\\u{\\i}" ?Ä­)

 ("\\i" ?Ä±) ;; ("{\\i}" ?Ä±)
 ("\\^{\\j}" ?Äµ)

 ("\\L" ?Å) ;; ("{\\L}" ?Å)
 ("\\l" ?Å‚) ;; ("{\\l}" ?Å‚)

 ("\\H" ?Ì‹)
 ("\\H{}" ?Ë)
 ("\\U{o}" ?Å‘) ("\\Uo" ?Å‘) ;; FIXME: Was it just a typo?

 ("\\OE" ?Å’) ;; ("{\\OE}" ?Å’)
 ("\\oe" ?Å“) ;; ("{\\oe}" ?Å“)

 ("\\v{\\i}" ?Ç)

 ("\\={\\AE}" ?Ç¢) ("\\=\\AE" ?Ç¢)
 ("\\={\\ae}" ?Ç£) ("\\=\\ae" ?Ç£)

 ("\\v{\\j}" ?Ç°)
 ("\\'{\\AE}" ?Ç¼) ("\\'\\AE" ?Ç¼)
 ("\\'{\\ae}" ?Ç½) ("\\'\\ae" ?Ç½)
 ("\\'{\\O}" ?Ç¾) ("\\'\\O" ?Ç¾)
 ("\\'{\\o}" ?Ç¿) ("\\'\\o" ?Ç¿)

 ("\\," ?â€¯)
 ("\\/" ?â€Œ)
 ("\\:" ?â€…)
 ("\\;" ?â€„)


 ;; ;; Dominique Unruh: Disabling _1 etc.
 ;; ((lambda (name char)
 ;;    (let* ((base (concat (match-string 1 name) (match-string 3 name)))
 ;;           (basechar (cdr (assoc base (ucs-names)))))
 ;;      (when (qrhl-input--ascii-p basechar)
 ;;        (string (if (match-end 2) ?^ ?_) basechar))))
 ;;  "\\(.*\\)SU\\(?:B\\|\\(PER\\)\\)SCRIPT \\(.*\\)")

 ((lambda (name _char)
    (let* ((basename (match-string 2 name))
           (name (if (match-end 1) (capitalize basename) (downcase basename))))
      (concat "^" (if (> (length name) 1) "\\") name)))
  "\\`MODIFIER LETTER \\(?:SMALL\\|CAPITA\\(L\\)\\) \\([[:ascii:]]+\\)\\'")

 ;; ((lambda (name char) (format "^%s" (downcase (match-string 1 name))))
 ;;  "\\`MODIFIER LETTER SMALL \\(.\\)\\'")
 ;; ("^\\1" "\\`MODIFIER LETTER CAPITAL \\(.\\)\\'")
 ("^o_" ?Âº)
 ("^{SM}" ?â„ )
 ("^{TEL}" ?â„¡)
 ("^{TM}" ?â„¢)

 ("\\b" ?Ì±)

 ("\\rq" ?â€™)

 ;; FIXME: Provides some useful entries (yen, euro, copyright, registered,
 ;; currency, minus, micro), but also a lot of dubious ones.
 ((lambda (name char)
    (unless (or (qrhl-input--ascii-p char)
                ;; We prefer COMBINING LONG SOLIDUS OVERLAY for \not.
                (member name '("NOT SIGN")))
      (concat "\\" (downcase (match-string 1 name)))))
  "\\`\\([^- ]+\\) SIGN\\'")

 ((lambda (name char)
    ;; "GREEK SMALL LETTER PHI" (which is \phi) and "GREEK PHI SYMBOL"
    ;; (which is \varphi) are reversed in `ucs-names', so we define
    ;; them manually.
    (unless (string-match-p "\\<PHI\\>" name)
      (concat "\\" (funcall (if (match-end 1) #' capitalize #'downcase)
                            (match-string 2 name)))))
  "\\`GREEK \\(?:SMALL\\|CAPITA\\(L\\)\\) LETTER \\([^- ]+\\)\\'")

 ("\\phi" ?Ï•)
 ("\\Box" ?â–¡)
 ("\\Bumpeq" ?â‰)
 ("\\Cap" ?â‹’)
 ("\\Cup" ?â‹“)
 ("\\Diamond" ?â—‡)
 ("\\Downarrow" ?â‡“)
 ("\\H{o}" ?Å‘)
 ("\\Im" ?â„‘)
 ("\\Join" ?â‹ˆ)
 ("\\Leftarrow" ?â‡)
 ("\\Leftrightarrow" ?â‡”)
 ("\\Ll" ?â‹˜)
 ("\\Lleftarrow" ?â‡š)
 ("\\Longleftarrow" ?â‡)
 ("\\Longleftrightarrow" ?â‡”)
 ("\\Longrightarrow" ?â‡’)
 ("\\Lsh" ?â†°)
 ("\\Re" ?â„œ)
 ("\\Rightarrow" ?â‡’)
 ("\\Rrightarrow" ?â‡›)
 ("\\Rsh" ?â†±)
 ("\\Subset" ?â‹)
 ("\\Supset" ?â‹‘)
 ("\\Uparrow" ?â‡‘)
 ("\\Updownarrow" ?â‡•)
 ("\\Vdash" ?âŠ©)
 ("\\Vert" ?â€–)
 ("\\Vvdash" ?âŠª)
 ("\\aleph" ?â„µ)
 ("\\amalg" ?âˆ)
 ("\\angle" ?âˆ )
 ("\\approx" ?â‰ˆ)
 ("\\approxeq" ?â‰Š)
 ("\\ast" ?âˆ—)
 ("\\asymp" ?â‰)
 ("\\backcong" ?â‰Œ)
 ("\\backepsilon" ?âˆ)
 ("\\backprime" ?â€µ)
 ("\\backsim" ?âˆ½)
 ("\\backsimeq" ?â‹)
 ("\\backslash" ?\\)
 ("\\barwedge" ?âŠ¼)
 ("\\because" ?âˆµ)
 ("\\beth" ?â„¶)
 ("\\between" ?â‰¬)
 ("\\bigcap" ?â‹‚)
 ("\\bigcirc" ?â—¯)
 ("\\bigcup" ?â‹ƒ)
 ("\\bigstar" ?â˜…)
 ("\\bigtriangledown" ?â–½)
 ("\\bigtriangleup" ?â–³)
 ("\\bigvee" ?â‹)
 ("\\bigwedge" ?â‹€)
 ("\\blacklozenge" ?âœ¦)
 ("\\blacksquare" ?â–ª)
 ("\\blacktriangle" ?â–´)
 ("\\blacktriangledown" ?â–¾)
 ("\\blacktriangleleft" ?â—‚)
 ("\\blacktriangleright" ?â–¸)
 ("\\bot" ?âŠ¥)
 ("\\bowtie" ?â‹ˆ)
 ("\\boxminus" ?âŠŸ)
 ("\\boxplus" ?âŠ)
 ("\\boxtimes" ?âŠ )
 ("\\bullet" ?â€¢)
 ("\\bumpeq" ?â‰)
 ("\\cap" ?âˆ©)
 ("\\cdots" ?â‹¯)
 ("\\centerdot" ?â‹…)
 ("\\checkmark" ?âœ“)
 ("\\chi" ?Ï‡)
 ("\\circ" ?âˆ˜)
 ("\\circeq" ?â‰—)
 ("\\circlearrowleft" ?â†º)
 ("\\circlearrowright" ?â†»)
 ("\\circledR" ?Â®)
 ("\\circledS" ?â“ˆ)
 ("\\circledast" ?âŠ›)
 ("\\circledcirc" ?âŠš)
 ("\\circleddash" ?âŠ)
 ("\\clubsuit" ?â™£)
 ("\\coloneq" ?â‰”)
 ("\\complement" ?âˆ)
 ("\\cong" ?â‰…)
 ("\\coprod" ?âˆ)
 ("\\cup" ?âˆª)
 ("\\curlyeqprec" ?â‹)
 ("\\curlyeqsucc" ?â‹Ÿ)
 ("\\curlypreceq" ?â‰¼)
 ("\\curlyvee" ?â‹)
 ("\\curlywedge" ?â‹)
 ("\\curvearrowleft" ?â†¶)
 ("\\curvearrowright" ?â†·)

 ("\\dag" ?â€ )
 ("\\dagger" ?â€ )
 ("\\daleth" ?â„¸)
 ("\\dashv" ?âŠ£)
 ("\\ddag" ?â€¡)
 ("\\ddagger" ?â€¡)
 ("\\ddots" ?â‹±)
 ("\\diamond" ?â‹„)
 ("\\diamondsuit" ?â™¢)
 ("\\divideontimes" ?â‹‡)
 ("\\doteq" ?â‰)
 ("\\doteqdot" ?â‰‘)
 ("\\dotplus" ?âˆ”)
 ("\\dotsquare" ?âŠ¡)
 ("\\downarrow" ?â†“)
 ("\\downdownarrows" ?â‡Š)
 ("\\downleftharpoon" ?â‡ƒ)
 ("\\downrightharpoon" ?â‡‚)
 ("\\ell" ?â„“)
 ("\\emptyset" ?âˆ…)
 ("\\eqcirc" ?â‰–)
 ("\\eqcolon" ?â‰•)
 ("\\eqslantgtr" ?â‹)
 ("\\eqslantless" ?â‹œ)
 ("\\equiv" ?â‰¡)
 ("\\exists" ?âˆƒ)
 ("\\fallingdotseq" ?â‰’)
 ("\\flat" ?â™­)
 ("\\forall" ?âˆ€)
 ("\\frac1" ?â…Ÿ)
 ("\\frac12" ?Â½)
 ("\\frac13" ?â…“)
 ("\\frac14" ?Â¼)
 ("\\frac15" ?â…•)
 ("\\frac16" ?â…™)
 ("\\frac18" ?â…›)
 ("\\frac23" ?â…”)
 ("\\frac25" ?â…–)
 ("\\frac34" ?Â¾)
 ("\\frac35" ?â…—)
 ("\\frac38" ?â…œ)
 ("\\frac45" ?â…˜)
 ("\\frac56" ?â…š)
 ("\\frac58" ?â…)
 ("\\frac78" ?â…)
 ("\\frown" ?âŒ¢)
 ("\\ge" ?â‰¥)
 ("\\geq" ?â‰¥)
 ("\\geqq" ?â‰§)
 ("\\geqslant" ?â‰¥)
 ("\\gets" ?â†)
 ("\\gg" ?â‰«)
 ("\\ggg" ?â‹™)
 ("\\gimel" ?â„·)
 ("\\gnapprox" ?â‹§)
 ("\\gneq" ?â‰©)
 ("\\gneqq" ?â‰©)
 ("\\gnsim" ?â‹§)
 ("\\gtrapprox" ?â‰³)
 ("\\gtrdot" ?â‹—)
 ("\\gtreqless" ?â‹›)
 ("\\gtreqqless" ?â‹›)
 ("\\gtrless" ?â‰·)
 ("\\gtrsim" ?â‰³)
 ("\\gvertneqq" ?â‰©)
 ("\\hbar" ?â„)
 ("\\heartsuit" ?â™¥)
 ("\\hookleftarrow" ?â†©)
 ("\\hookrightarrow" ?â†ª)
 ;("\\iff" ?â‡”) ;; Defined below now
 ("\\imath" ?Ä±)
 ("\\in" ?âˆˆ)
 ("\\infty" ?âˆ)
 ("\\int" ?âˆ«)
 ("\\intercal" ?âŠº)
 ("\\langle" ?âŸ¨) ;; Was ?âŒ©, see bug#12948.
 ("\\lbrace" ?{)
 ("\\lbrack" ?\[)
 ("\\lceil" ?âŒˆ)
 ("\\ldots" ?â€¦)
 ("\\le" ?â‰¤)
 ("\\leadsto" ?â†)
 ("\\leftarrow" ?â†)
 ("\\leftarrowtail" ?â†¢)
 ("\\leftharpoondown" ?â†½)
 ("\\leftharpoonup" ?â†¼)
 ("\\leftleftarrows" ?â‡‡)
 ;; ("\\leftparengtr" ?âŒ©), see bug#12948.
 ("\\leftrightarrow" ?â†”)
 ("\\leftrightarrows" ?â‡†)
 ("\\leftrightharpoons" ?â‡‹)
 ("\\leftrightsquigarrow" ?â†­)
 ("\\leftthreetimes" ?â‹‹)
 ("\\leq" ?â‰¤)
 ("\\leqq" ?â‰¦)
 ("\\leqslant" ?â‰¤)
 ("\\lessapprox" ?â‰²)
 ("\\lessdot" ?â‹–)
 ("\\lesseqgtr" ?â‹š)
 ("\\lesseqqgtr" ?â‹š)
 ("\\lessgtr" ?â‰¶)
 ("\\lesssim" ?â‰²)
 ("\\lfloor" ?âŒŠ)
 ("\\lhd" ?â—)
 ("\\rhd" ?â–·)
 ("\\ll" ?â‰ª)
 ("\\llcorner" ?âŒ)
 ("\\lnapprox" ?â‹¦)
 ("\\lneq" ?â‰¨)
 ("\\lneqq" ?â‰¨)
 ("\\lnsim" ?â‹¦)
 ("\\longleftarrow" ?â†)
 ("\\longleftrightarrow" ?â†”)
 ("\\longmapsto" ?â†¦)
 ("\\longrightarrow" ?â†’)
 ("\\looparrowleft" ?â†«)
 ("\\looparrowright" ?â†¬)
 ("\\lozenge" ?âœ§)
 ("\\lq" ?â€˜)
 ("\\lrcorner" ?âŒŸ)
 ("\\ltimes" ?â‹‰)
 ("\\lvertneqq" ?â‰¨)
 ("\\maltese" ?âœ )
 ("\\mapsto" ?â†¦)
 ("\\measuredangle" ?âˆ¡)
 ("\\mho" ?â„§)
 ("\\mid" ?âˆ£)
 ("\\models" ?âŠ§)
 ("\\mp" ?âˆ“)
 ("\\multimap" ?âŠ¸)
 ("\\nLeftarrow" ?â‡)
 ("\\nLeftrightarrow" ?â‡)
 ("\\nRightarrow" ?â‡)
 ("\\nVDash" ?âŠ¯)
 ("\\nVdash" ?âŠ®)
 ("\\nabla" ?âˆ‡)
 ("\\napprox" ?â‰‰)
 ("\\natural" ?â™®)
 ("\\ncong" ?â‰‡)
 ("\\ne" ?â‰ )
 ("\\nearrow" ?â†—)
 ("\\neg" ?Â¬)
 ("\\neq" ?â‰ )
 ("\\nequiv" ?â‰¢)
 ("\\newline" ?â€¨)
 ("\\nexists" ?âˆ„)
 ("\\ngeq" ?â‰±)
 ("\\ngeqq" ?â‰±)
 ("\\ngeqslant" ?â‰±)
 ("\\ngtr" ?â‰¯)
 ("\\ni" ?âˆ‹)
 ("\\nleftarrow" ?â†š)
 ("\\nleftrightarrow" ?â†®)
 ("\\nleq" ?â‰°)
 ("\\nleqq" ?â‰°)
 ("\\nleqslant" ?â‰°)
 ("\\nless" ?â‰®)
 ("\\nmid" ?âˆ¤)
 ("\\not" ?Ì¸)                            ;FIXME: conflict with "NOT SIGN" Â¬.
 ("\\notin" ?âˆ‰)
 ("\\nparallel" ?âˆ¦)
 ("\\nprec" ?âŠ€)
 ("\\npreceq" ?â‹ )
 ("\\nrightarrow" ?â†›)
 ("\\nshortmid" ?âˆ¤)
 ("\\nshortparallel" ?âˆ¦)
 ("\\nsim" ?â‰)
 ("\\nsimeq" ?â‰„)
 ("\\nsubset" ?âŠ„)
 ("\\nsubseteq" ?âŠˆ)
 ("\\nsubseteqq" ?âŠˆ)
 ("\\nsucc" ?âŠ)
 ("\\nsucceq" ?â‹¡)
 ("\\nsupset" ?âŠ…)
 ("\\nsupseteq" ?âŠ‰)
 ("\\nsupseteqq" ?âŠ‰)
 ("\\ntriangleleft" ?â‹ª)
 ("\\ntrianglelefteq" ?â‹¬)
 ("\\ntriangleright" ?â‹«)
 ("\\ntrianglerighteq" ?â‹­)
 ("\\nvDash" ?âŠ­)
 ("\\nvdash" ?âŠ¬)
 ("\\nwarrow" ?â†–)
 ("\\odot" ?âŠ™)
 ("\\oint" ?âˆ®)
 ("\\ominus" ?âŠ–)
 ("\\oplus" ?âŠ•)
 ("\\oslash" ?âŠ˜)
 ("\\otimes" ?âŠ—)
 ("\\par" ?â€©)
 ("\\parallel" ?âˆ¥)
 ("\\partial" ?âˆ‚)
 ("\\perp" ?âŠ¥)
 ("\\pitchfork" ?â‹”)
 ("\\prec" ?â‰º)
 ("\\precapprox" ?â‰¾)
 ("\\preceq" ?â‰¼)
 ("\\precnapprox" ?â‹¨)
 ("\\precnsim" ?â‹¨)
 ("\\precsim" ?â‰¾)
 ("\\prime" ?â€²)
 ("\\prod" ?âˆ)
 ("\\propto" ?âˆ)
 ("\\qed" ?âˆ)
 ("\\quad" ?â€)
 ("\\rangle" ?\âŸ©) ;; Was ?âŒª, see bug#12948.
 ("\\rbrace" ?})
 ("\\rbrack" ?\])
 ("\\rceil" ?âŒ‰)
 ("\\rfloor" ?âŒ‹)
 ("\\rightarrow" ?â†’)
 ("\\rightarrowtail" ?â†£)
 ("\\rightharpoondown" ?â‡)
 ("\\rightharpoonup" ?â‡€)
 ("\\rightleftarrows" ?â‡„)
 ("\\rightleftharpoons" ?â‡Œ)
 ;; ("\\rightparengtr" ?â¦”) ;; Was ?âŒª, see bug#12948.
 ("\\rightrightarrows" ?â‡‰)
 ("\\rightthreetimes" ?â‹Œ)
 ("\\risingdotseq" ?â‰“)
 ("\\rtimes" ?â‹Š)
 ("\\sbs" ?ï¹¨)
 ("\\searrow" ?â†˜)
 ("\\setminus" ?âˆ–)
 ("\\sharp" ?â™¯)
 ("\\shortmid" ?âˆ£)
 ("\\shortparallel" ?âˆ¥)
 ("\\sim" ?âˆ¼)
 ("\\simeq" ?â‰ƒ)
 ("\\smallamalg" ?âˆ)
 ("\\smallsetminus" ?âˆ–)
 ("\\smallsmile" ?âŒ£)
 ("\\smile" ?âŒ£)
 ("\\spadesuit" ?â™ )
 ("\\sphericalangle" ?âˆ¢)
 ("\\sqcap" ?âŠ“)
 ("\\sqcup" ?âŠ”)
 ("\\sqsubset" ?âŠ)
 ("\\sqsubseteq" ?âŠ‘)
 ("\\sqsupset" ?âŠ)
 ("\\sqsupseteq" ?âŠ’)
 ("\\square" ?â–¡)
 ("\\squigarrowright" ?â‡)
 ("\\star" ?â‹†)
 ("\\straightphi" ?Ï†)
 ("\\subset" ?âŠ‚)
 ("\\subseteq" ?âŠ†)
 ("\\subseteqq" ?âŠ†)
 ("\\subsetneq" ?âŠŠ)
 ("\\subsetneqq" ?âŠŠ)
 ("\\succ" ?â‰»)
 ("\\succapprox" ?â‰¿)
 ("\\succcurlyeq" ?â‰½)
 ("\\succeq" ?â‰½)
 ("\\succnapprox" ?â‹©)
 ("\\succnsim" ?â‹©)
 ("\\succsim" ?â‰¿)
 ("\\sum" ?âˆ‘)
 ("\\supset" ?âŠƒ)
 ("\\supseteq" ?âŠ‡)
 ("\\supseteqq" ?âŠ‡)
 ("\\supsetneq" ?âŠ‹)
 ("\\supsetneqq" ?âŠ‹)
 ("\\surd" ?âˆš)
 ("\\swarrow" ?â†™)
 ("\\therefore" ?âˆ´)
 ("\\thickapprox" ?â‰ˆ)
 ("\\thicksim" ?âˆ¼)
 ("\\to" ?â†’)
 ("\\top" ?âŠ¤)
 ("\\triangle" ?â–µ)
 ("\\triangledown" ?â–¿)
 ("\\triangleleft" ?â—ƒ)
 ("\\trianglelefteq" ?âŠ´)
 ("\\triangleq" ?â‰œ)
 ("\\triangleright" ?â–¹)
 ("\\trianglerighteq" ?âŠµ)
 ("\\twoheadleftarrow" ?â†)
 ("\\twoheadrightarrow" ?â† )
 ("\\ulcorner" ?âŒœ)
 ("\\uparrow" ?â†‘)
 ("\\updownarrow" ?â†•)
 ("\\upleftharpoon" ?â†¿)
 ("\\uplus" ?âŠ)
 ("\\uprightharpoon" ?â†¾)
 ("\\upuparrows" ?â‡ˆ)
 ("\\urcorner" ?âŒ)
 ("\\u{i}" ?Ä­)
 ("\\vDash" ?âŠ¨)

 ((lambda (name char)
    ;; "GREEK SMALL LETTER PHI" (which is \phi) and "GREEK PHI SYMBOL"
    ;; (which is \varphi) are reversed in `ucs-names', so we define
    ;; them manually.
    (unless (string-match-p "\\<PHI\\>" name)
      (concat "\\var" (downcase (match-string 1 name)))))
  "\\`GREEK \\([^- ]+\\) SYMBOL\\'")

 ("\\varphi" ?Ï†)
 ("\\varprime" ?â€²)
 ("\\varpropto" ?âˆ)
 ("\\varsigma" ?Ï‚)
 ("\\vartriangleleft" ?âŠ²)
 ("\\vartriangleright" ?âŠ³)
 ("\\vdash" ?âŠ¢)
 ("\\vdots" ?â‹®)
 ("\\vee" ?âˆ¨)
 ("\\veebar" ?âŠ»)
 ("\\vert" ?|)
 ("\\wedge" ?âˆ§)
 ("\\wp" ?â„˜)
 ("\\wr" ?â‰€)

 ("\\Bbb{N}" ?â„•)			; AMS commands for blackboard bold
 ("\\Bbb{P}" ?â„™)			; Also sometimes \mathbb.
 ("\\Bbb{R}" ?â„)
 ("\\Bbb{Z}" ?â„¤)
 ("--" ?â€“)
 ("---" ?â€”)
 ;; We used to use ~ for NBSP but that's inconvenient and may even look like
 ;; a bug where the user finds his ~ key doesn't insert a ~ any more.
 ("\\ " ?Â )
 ("\\\\" ?\\)
 ("\\mathscr{I}" ?â„)			; moment of inertia
 ("\\Smiley" ?â˜º)
 ("\\blacksmiley" ?â˜»)
 ("\\Frowny" ?â˜¹)
 ("\\Letter" ?âœ‰)
 ("\\permil" ?â€°)
 ;; Probably not useful enough:
 ;; ("\\Telefon" ?â˜)			; there are other possibilities
 ;; ("\\Radioactivity" ?â˜¢)
 ;; ("\\Biohazard" ?â˜£)
 ;; ("\\Male" ?â™‚)
 ;; ("\\Female" ?â™€)
 ;; ("\\Lightning" ?â˜‡)
 ;; ("\\Mercury" ?â˜¿)
 ;; ("\\Earth" ?â™)
 ;; ("\\Jupiter" ?â™ƒ)
 ;; ("\\Saturn" ?â™„)
 ;; ("\\Uranus" ?â™…)
 ;; ("\\Neptune" ?â™†)
 ;; ("\\Pluto" ?â™‡)
 ;; ("\\Sun" ?â˜‰)
 ;; ("\\Writinghand" ?âœ)
 ;; ("\\Yinyang" ?â˜¯)
 ;; ("\\Heart" ?â™¡)
 ("\\dh" ?Ã°)
 ("\\DH" ?Ã)
 ("\\th" ?Ã¾)
 ("\\TH" ?Ã)
 ("\\lnot" ?Â¬)
 ("\\ordfeminine" ?Âª)
 ("\\ordmasculine" ?Âº)
 ("\\lambdabar" ?Æ›)
 ("\\celsius" ?â„ƒ)
 ;; by analogy with lq, rq:
 ("\\ldq" ?\â€œ)
 ("\\rdq" ?\â€)
 ("\\defs" ?â‰™)				; per fuzz/zed
 ;; ("\\sqrt[3]" ?âˆ›)
 ("\\llbracket" ?\âŸ¦) 			; stmaryrd
 ("\\rrbracket" ?\âŸ§)
 ;; ("\\lbag" ?\ã€š) 			; fuzz
 ;; ("\\rbag" ?\ã€›)
 ("\\ldata" ?\ã€Š) 			; fuzz/zed
 ("\\rdata" ?\ã€‹)
 ;; From Karl Eichwalder.
 ("\\glq"  ?â€š)
 ("\\grq"  ?â€˜)
 ("\\glqq"  ?â€) ("\\\"`"  ?â€)
 ("\\grqq"  ?â€œ) ("\\\"'"  ?â€œ)
 ("\\flq" ?â€¹)
 ("\\frq" ?â€º)
 ("\\flqq" ?\Â«) ("\\\"<" ?\Â«)
 ("\\frqq" ?\Â») ("\\\">" ?\Â»)

 ("\\-" ?Â­)   ;; soft hyphen

 ("\\textmu" ?Âµ)
 ("\\textfractionsolidus" ?â„)
 ("\\textbigcircle" ?âƒ)
 ("\\textmusicalnote" ?â™ª)
 ("\\textdied" ?âœ)
 ("\\textcolonmonetary" ?â‚¡)
 ("\\textwon" ?â‚©)
 ("\\textnaira" ?â‚¦)
 ("\\textpeso" ?â‚±)
 ("\\textlira" ?â‚¤)
 ("\\textrecipe" ?â„)
 ("\\textinterrobang" ?â€½)
 ("\\textpertenthousand" ?â€±)
 ("\\textbaht" ?à¸¿)
 ("\\textnumero" ?â„–)
 ("\\textdiscount" ?â’)
 ("\\textestimated" ?â„®)
 ("\\textopenbullet" ?â—¦)
 ("\\textlquill" ?\â…)
 ("\\textrquill" ?\â†)
 ("\\textcircledP" ?â„—)
 ("\\textreferencemark" ?â€»)
 )


;; Dominique's rules for qrhl-tool:
(quail-define-rules
 ((append . t))
 ("\\ox" ?âŠ—)
 ("\\ket" ["|âŸ©"])
 ("\\ket0" ["|0âŸ©"])
 ("\\ket1" ["|1âŸ©"])
 ("[|" ["âŸ¦"])
 ("|]" ["âŸ§"])
 (">>" ?Â»)
 ("\\Cla" ["â„­ğ”©ğ”"])
 ("\\qeq" ["â‰¡ğ”®"])
 ("\\equiv_q" ["â‰¡ğ”®"])
 ("\\sub" ?â‡©)
 ("\\sup" ?â‡§)
 ("*_C" ["*â‡©C"])
 ("*_V" ["*â‡©V"])
 ("o_CL" ["oâ‡©Câ‡©L"])
 ("*_S" ["*â‡©S"])
 ("\\ox_l" ["âŠ—â‡©l"])
 ("\\ox_o" ["âŠ—â‡©o"])
 ("\\ox_S" ["âŠ—â‡©S"])
 ("\\in_q" ["âˆˆâ‡©ğ”®"])
 ("=_q" ["=â‡©ğ”®"])
 ("\\fun" ["â‡’"])
 ("\\fun_CL" ["â‡’â‡©Câ‡©L"])
 ("\\implies" ?âŸ¶)
 ("\\iff" ?âŸ·)
 )

(provide 'qrhl-input)

;;; qrhl-input.el ends here
